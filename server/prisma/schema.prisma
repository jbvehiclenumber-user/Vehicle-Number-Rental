// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 회사 정보
model Company {
  id                String    @id @default(uuid())
  businessNumber    String    @unique @map("business_number") // 사업자등록번호
  companyName       String    @map("company_name")
  representative    String
  phone             String
  contactPhone      String?   @map("contact_phone") // 기사들이 연락받을 번호
  email             String?
  password          String    // 해시된 비밀번호
  verified          Boolean   @default(false)
  verifiedAt        DateTime? @map("verified_at")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  // 관계
  vehicles          Vehicle[]
  
  @@map("companies")
}

// 개인(기사) 정보
model User {
  id            String    @id @default(uuid())
  name          String
  phone         String    @unique
  email         String?   @unique // 이메일 (SMS 인증 대신 사용)
  password      String    // 해시된 비밀번호
  verified      Boolean   @default(false)
  verifiedAt    DateTime? @map("verified_at")
  lastLogin     DateTime? @map("last_login")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  // 관계
  payments      Payment[]
  
  @@map("users")
}

// 차량 번호 정보
model Vehicle {
  id              String    @id @default(uuid())
  companyId       String    @map("company_id")
  vehicleNumber   String    @map("vehicle_number")
  vehicleType     String    @map("vehicle_type") // 택시, 화물차, 버스 등
  tonnage         String?   // 톤수 (1톤, 2.5톤 등)
  yearModel       Int?      @map("year_model") // 연식
  region          String    // 지역 (서울, 경기, 인천 등)
  insuranceRate   Int       @map("insurance_rate") // 보험료 (%)
  monthlyFee      Int       @map("monthly_fee") // 월 지입료 (원)
  description     String?   // 추가 설명
  isAvailable     Boolean   @default(true) @map("is_available")
  viewCount       Int       @default(0) @map("view_count") // 조회수
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // 관계
  company         Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  payments        Payment[]
  
  @@map("vehicles")
  @@index([region])
  @@index([vehicleType])
  @@index([isAvailable])
  @@index([monthlyFee])
  @@index([yearModel])
}

// 결제 및 조회 이력
model Payment {
  id              String    @id @default(uuid())
  userId          String    @map("user_id")
  vehicleId       String    @map("vehicle_id")
  amount          Int       @default(10000) // 고정 결제 금액 (1만원)
  paymentMethod   String?   @map("payment_method") // 결제 수단 (card, bank_transfer 등)
  paymentKey      String?   @unique @map("payment_key") // 토스페이먼츠 키
  orderId         String?   @unique @map("order_id") // 주문 ID
  status          String    @default("pending") // pending, completed, failed, cancelled
  paidAt          DateTime? @map("paid_at")
  cancelledAt     DateTime? @map("cancelled_at")
  createdAt       DateTime  @default(now()) @map("created_at")

  // 관계
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  vehicle         Vehicle   @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  @@map("payments")
  @@index([userId])
  @@index([vehicleId])
  @@index([status])
  @@index([paidAt])
}

// 관리자 (추후 필요시)
model Admin {
  id          String   @id @default(uuid())
  username    String   @unique
  password    String
  email       String   @unique
  role        String   @default("admin")
  createdAt   DateTime @default(now()) @map("created_at")
  
  @@map("admins")
}